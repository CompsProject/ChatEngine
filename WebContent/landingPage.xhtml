<?xml version="1.0" encoding="UTF-8"?>

<!--
This is the page that users will see when they first input the url.

-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

  <head>
    <title>Landing Page</title>
    <link id="titleIcon" href="img/chatbubble-outline.png" rel="shortcut icon"/>
    <link rel="stylesheet" type="text/css" href="css/landingPage.css"/>
     
    <script src="js/utility.js"></script>
    <script type="application/javascript"><![CDATA[ 
        "use strict";
        var Chat = {};
        
        Chat.socket = null;
        
        var host = '';
        window.name = "";

        Chat.connect = (function(host) {
        //this function is called when Chat object is initialized
        //Chat object contains Websocket and can be used to send/receive messages
            
            //window.host = host;
            //util_webSocketCheck();
            
             //create websocket object if browser supports it
            if ('WebSocket' in window) {
                Chat.socket = new WebSocket(host);                 
            } else if ('MozWebSocket' in window) {
                Chat.socket = new MozWebSocket(host);                   
            } else {
                //browser doesn't support websocket
                Console.log('Error: WebSocket is not supported by this browser.');
                return;
            }

            Chat.socket.onopen = function () {
            	util_changeIcon(true);
                //connection opened
            };

            Chat.socket.onclose = function () {
            	util_changeIcon(false);
                //connection closed
            };
            
            //Chat.socket.onclose = util_close();

            Chat.socket.onmessage = function (message) {
                //message received
                //check message to determine which page to display next.
                var xml = message.data;
                var parser = new DOMParser();
                var xmlDoc = parser.parseFromString(xml,"text/xml");
                var messageNode = xmlDoc.getElementsByTagName('message')[0];
                var messageType = messageNode.getAttribute('type');
                var clientID = messageNode.getAttribute('senderID');                
                
                //set persistent clientID inside window.name object
                //this value will persist until browser tab is closed
                //Note: window.name will maintain new value for each open tab.
                if(typeof(Storage) !== "undefined") {
                    //make sure that the browser supports window.name feature. 
                    window.name = clientID;
                } else {
                    // Sorry! No Web Storage support..
                    alert('no local storage support');
                }
                
                if (messageType == 'redirect'){
                	util_redirect(messageNode);
                } else if (messageType == 'checkGroups') {
                	//capture, but ignore
                	return;
                } else {
                	alert("Could not parse server message: \n"+
                		message);
                }
                
                /*
                //check type of message to determine which page to display
                if (messageType == 'displayAdmin'){
                    //client selected 'create groups' and was assigned a clientID from server
                    //so display the admin page.                    
                    window.location.href = 'http://'+window.location.host + '/Chat/admin.xhtml';
                } else if (messageType == 'displayLogin'){
                    //client selected 'login' and was assigned a clientID from server
                    //so display the login page.
                    window.location.href = 'http://'+window.location.host + '/Chat/login.xhtml';
                } else{
                    alert('landing page received incomprehensible message');
                }
               */
                             
                
            }; //end onmessage
        }); //end Chat.connect()

       /* Chat.initialize = function() {
            if (window.location.protocol == 'http:') {                
                Chat.connect('ws://' + window.location.host + '/Chat/landing');
            } else {
                Chat.connect('wss://' + window.location.host + '/Chat/landing');
            }
        }    */    

             
        
		Chat.initialize = util_webSocketConnect;
        Chat.initialize('landing');
		window.onunload = util_closeSocket();
        //Chat.initialize();
                
        
        function setUserType(){
            //send user type to server.
            var userType = document.getElementById('userType').value; 
            //alert('userType: '+userType);
            var xml = '<message type="setUserType">'+
            '<text>'+userType+'</text>'+
            '</message>';
            Chat.socket.send(xml);
            //alert('sent xml');
        }

    ]]>        
        
    
    </script>  
    
    
  </head>
  <body>
    <h1>Computer Mediated Problem Solving</h1>
    <p style="color:Blue">Try not to use <strong>refresh</strong> or <strong>back</strong> <br/> to change pages while on this site</p>
    <p>Students go to <strong>Login</strong></p>
    <p>TA's go to <strong>Admin Monitor</strong></p>
    <div>
      <p>Select Desired Function:</p>
      <select id='userType'>
        <option title="Students login from here">Login</option>
        <option title="Use to create new groups/log files">Admin</option>
        <option>Admin Monitor</option>
      </select>
      <button onclick='setUserType()'>Submit</button>
    </div>
    <!-- <div id='main_image'>   </div> -->
  </body>

</html>